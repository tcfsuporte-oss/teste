<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Memory Leak Mode ðŸ’€</title>
<style>
body {
    margin: 0;
    background: black;
    overflow: hidden;
    font-family: monospace;
}
#stats {
    position: fixed;
    top: 10px;
    left: 10px;
    color: #00ff00;
    background: rgba(0,0,0,0.7);
    padding: 10px;
    border: 1px solid #00ff00;
}
canvas {
    display: block;
}
</style>
</head>
<body>

<div id="stats">
FPS: <span id="fps">0</span><br>
MemÃ³ria: <span id="mem">0</span> MB<br>
Objetos: <span id="count">0</span>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particles = [];
let junkMemory = []; // ðŸ’€ vazamento proposital

let ball = {
    x: canvas.width/2,
    y: canvas.height/2,
    dx: 4,
    dy: 4,
    speed: 4,
    radius: 10
};

let lastTime = performance.now();
let startTime = performance.now();

function randomDirection(speed) {
    let angle = Math.random() * Math.PI * 2;
    return {
        dx: Math.cos(angle) * speed,
        dy: Math.sin(angle) * speed
    };
}

function createExplosion(x, y, amount) {
    for (let i = 0; i < amount; i++) {
        particles.push({
            x: x,
            y: y,
            dx: (Math.random()-0.5)*10,
            dy: (Math.random()-0.5)*10,
            size: Math.random()*3,
            hue: Math.random()*360
            // ðŸ’€ SEM LIFE â†’ nunca removemos
        });
    }
}

function update() {

    let now = performance.now();
    let fps = Math.round(1000 / (now - lastTime));
    lastTime = now;
    document.getElementById("fps").innerText = fps;

    if (performance.memory) {
        let mem = performance.memory.usedJSHeapSize / 1048576;
        document.getElementById("mem").innerText = mem.toFixed(2);
    } else {
        document.getElementById("mem").innerText = "N/A";
    }

    ctx.fillStyle = "rgba(0,0,0,0.1)";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ball.x += ball.dx;
    ball.y += ball.dy;

    let collided = false;

    if (ball.x <= 0 || ball.x >= canvas.width) collided = true;
    if (ball.y <= 0 || ball.y >= canvas.height) collided = true;

    let elapsed = (now - startTime) / 1000;

    if (collided) {
        ball.speed += 0.5;
        let dir = randomDirection(ball.speed);
        ball.dx = dir.dx;
        ball.dy = dir.dy;

        // ðŸ”¥ comeÃ§a leve...
        let amount = 100 + Math.floor(elapsed * 200);

        createExplosion(ball.x, ball.y, amount);

        // ðŸ’€ MEMORY LEAK INTENCIONAL
        junkMemory.push(new Array(999999).fill(Math.random()));
    }

    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
    ctx.fillStyle = `hsl(${Date.now()/5%360},100%,50%)`;
    ctx.shadowBlur = 30;
    ctx.shadowColor = ctx.fillStyle;
    ctx.fill();
    ctx.shadowBlur = 0;

    for (let i = 0; i < particles.length; i++) {
        let p = particles[i];
        p.x += p.dx;
        p.y += p.dy;

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
        ctx.fillStyle = `hsl(${p.hue},100%,50%)`;
        ctx.fill();
    }

    document.getElementById("count").innerText =
        particles.length + junkMemory.length;

    requestAnimationFrame(update);
}

update();
</script>

</body>
</html>
